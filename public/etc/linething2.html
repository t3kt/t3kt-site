<!DOCTYPE html>
<html>
<head>
  <title>line thing 2</title>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="/etc/linething2.js">;</script>
</head>
<body>
<h1>line thing 2</h1>

<div id="linething-container">
  <canvas id="linething-canvas" width="500" height="500" style="display: inline-block;">your browser probably doesn't support this if you can see this text</canvas>
  <style>
    #linething-options label {
      display: inline-block;
      min-width: 8em;
    }

    #linething-container {
      vertical-align: top;
    }
    #linething-opts-grid input[type=text]{
      width: 40px;
    }
  </style>
    <div style="display: inline-block;" class="control-panel">
    <h4>options</h4>

    <form id="linething-options">
      <div style="display: inline-block;">
        <ul>
          <li>
            <label for="linething-width">width:</label>
            <input type="number" id="linething-width" name="width" min="10" step="1" value="500"/>
          </li>
          <li>
            <label for="linething-height">height:</label>
            <input type="number" id="linething-height" name="height" min="10" step="1" value="500"/>
          </li>
          <li>
            <label for="linething-step">step:</label>
            <input type="number" id="linething-step" name="step" min="0" max="1" step="0.001" value="0.005"/>
          </li>
          <li>
            <label for="linething-color1-rgb">color 1:</label>
            <input type="color" id="linething-color1-rgb" name="color1-rgb" min="10" step="1" value="#666666"/>
            <input type="number" id="linething-color1-alpha" name="color1-alpha" min="0" max="1" step="0.1" value="0.1"/>
          </li>
          <li>
            <label for="linething-color2-rgb">color 2:</label>
            <input type="color" id="linething-color2-rgb" name="color2-rgb" min="10" step="1" value="#666666"/>
            <input type="number" id="linething-color2-alpha" name="color2-alpha" min="0" max="1" step="0.1" value="0.3"/>
          </li>
          <li>
            <label for="linething-color3-rgb">color 3:</label>
            <input type="color" id="linething-color3-rgb" name="color3-rgb" min="10" step="1" value="#666666"/>
            <input type="number" id="linething-color3-alpha" name="color3-alpha" min="0" max="1" step="0.1" value="0.1"/>
          </li>
          <li>
            <label for="linething-bgcolor-rgb">background:</label>
            <input type="color" id="linething-bgcolor-rgb" name="bgcolor-rgb" min="10" step="1" value="#DDDDDD"/>
            <input type="number" id="linething-bgcolor-alpha" name="bgcolor-alpha" min="0" max="1" step="0.1" value="1.0"/>
          </li>
        </ul>
      </div>
      <div style="display: inline-block;">
        <table style="border: 1px solid; border-collapse: collapse;" id="linething-opts-grid">
          <thead>
            <tr>
              <th>id</th>
              <th>start(x)</th>
              <th>start(y)</th>
              <th>end(x)</th>
              <th>end(y)</th>
              <th>next</th>
            </tr>
          </thead>
          <tr>
            <th><input type="text" name="path1id" value="path1"/></th>
            <td><input type="range" name="path1startx" min="0" max="1" step="0.1" value="0.0"/></td>
            <td><input type="range" name="path1starty" min="0" max="1" step="0.1" value="0.0"/></td>
            <td><input type="range" name="path1endx" min="0" max="1" step="0.1" value="1.0"/></td>
            <td><input type="range" name="path1endy" min="0" max="1" step="0.1" value="0.0"/></td>
            <td><input type="text" name="path1next" value="path2"/></td>
          </tr>
          <tr>
            <th><input type="text" name="path2id" value="path2"/></th>
            <td><input type="range" name="path2startx" min="0" max="1" step="0.1" value="1.0"/></td>
            <td><input type="range" name="path2starty" min="0" max="1" step="0.1" value="0.0"/></td>
            <td><input type="range" name="path2endx" min="0" max="1" step="0.1" value="1.0"/></td>
            <td><input type="range" name="path2endy" min="0" max="1" step="0.1" value="1.0"/></td>
            <td><input type="text" name="path2next" value="path3"/></td>
          </tr>
          <tr>
            <th><input type="text" name="path3id" value="path3"/></th>
            <td><input type="range" name="path3startx" min="0" max="1" step="0.1" value="1.0"/></td>
            <td><input type="range" name="path3starty" min="0" max="1" step="0.1" value="1.0"/></td>
            <td><input type="range" name="path3endx" min="0" max="1" step="0.1" value="0.0"/></td>
            <td><input type="range" name="path3endy" min="0" max="1" step="0.1" value="1.0"/></td>
            <td><input type="text" name="path3next" value="path4"/></td>
          </tr>
          <tr>
            <th><input type="text" name="path4id" value="path4"/></th>
            <td><input type="range" name="path4startx" min="0" max="1" step="0.1" value="0.0"/></td>
            <td><input type="range" name="path4starty" min="0" max="1" step="0.1" value="1.0"/></td>
            <td><input type="range" name="path4endx" min="0" max="1" step="0.1" value="0.0"/></td>
            <td><input type="range" name="path4endy" min="0" max="1" step="0.1" value="0.0"/></td>
            <td><input type="text" name="path4next" value="path1"/></td>
          </tr>
        </table>
        <div>
          <label>Point 1 start:</label>
          <input type="text" name="point1start" value="path1"/>
        </div>
        <div>
          <label>Point 2 start:</label>
          <input type="text" name="point2start" value="path3"/>
        </div>
      </div>
      <div>
        <button type="submit">update</button>
        <button type="button" id="linething-capture-button">capture</button>
      </div>
    </form>
  </div>
  <div>
    <img id="linething-capture-image" width="500" height="500" style="display: none;"/>
  </div>
  <script>
    $(function ()
    {
      function makeColor(rgb, alpha)
      {
        if (!rgb)
          return null;
        if (rgb.length == 7 && rgb.charAt(0) == '#')
        {
          return 'rgba(' + parseInt(rgb.substr(1, 2), 16) + ',' +
              parseInt(rgb.substr(3, 2), 16) + ',' +
              parseInt(rgb.substr(5, 2), 16) + ',' +
              alpha + ')';
        }
        return rgb;
      }

      function updateOptions()
      {
        var vals = {};
        $('#linething-options :input[name]').each(function ()
        {
          if(this.type=='radio'&&!this.checked)
            return;
          vals[this.name] = this.value;
        });
        var opts = {
          width: vals.width,
          height: vals.height,
          step: vals.step,
          color1: makeColor(vals['color1-rgb'], vals['color1-alpha']),
          color2: makeColor(vals['color2-rgb'], vals['color2-alpha']),
          color3: makeColor(vals['color3-rgb'], vals['color3-alpha']),
          bgColor: makeColor(vals['bgcolor-rgb'], vals['bgcolor-alpha']),
          point1start: vals.point1start,
          point2start: vals.point2start,
          paths: [
            {id:vals.path1id, start:[vals.path1startx*vals.width,vals.path1starty*vals.height],end:[vals.path1endx*vals.width,vals.path1endy*vals.height],next:vals.path1next},
            {id:vals.path2id, start:[vals.path2startx*vals.width,vals.path2starty*vals.height],end:[vals.path2endx*vals.width,vals.path2endy*vals.height],next:vals.path2next},
            {id:vals.path3id, start:[vals.path3startx*vals.width,vals.path3starty*vals.height],end:[vals.path3endx*vals.width,vals.path3endy*vals.height],next:vals.path3next},
            {id:vals.path4id, start:[vals.path4startx*vals.width,vals.path4starty*vals.height],end:[vals.path4endx*vals.width,vals.path4endy*vals.height],next:vals.path4next}
          ]
        };
        LineThing2.init($('#linething-canvas')[0], opts);
        return false;
      }

      $('#linething-capture-button').click(function ()
      {
        var dataurl = LineThing2.canvas.toDataURL();
        window.open(dataurl);
        //$('#linething-capture-image').show().attr('src', dataurl);
      });

      $('#linething-options').submit(function ()
      {
        updateOptions();
        return false;
      });
      $('#linething-canvas').one('mousemove', function ()
      {
        updateOptions();
      });
    });
  </script>
</div>
</body>
</html>